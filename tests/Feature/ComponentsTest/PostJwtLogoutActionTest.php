<?php

namespace Tests\Feature\ComponentTest;

use App\Http\Controllers\Api\Components\Jwt\PostJwtLoginAction;
use App\Http\Controllers\Api\Components\Jwt\PostJwtLogoutAction;
use App\Http\Controllers\Api\Components\Jwt\PostJwtRegisterAction;
use App\Models\User;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Illuminate\Foundation\Testing\WithFaker;
use Illuminate\Support\Facades\Artisan;
use Tests\TestCase;

class PostJwtLogoutActionTest extends TestCase
{
    use WithFaker;
    public function setUp(): void
    {
        parent::setUp(); // TODO: Change the autogenerated stub
        Artisan::call('migrate');
    }
    /**
     * A basic feature test example.
     *
     * @return void
     */
    public function test_logout_action()
    {
        $reg_data = [
            'fullname' => $this->faker->name,
            'username' => $this->faker->name,
            'phone'    =>  randomPhone(),
            'password' => '32132332321123',
        ];
        $login_data = [
            'username' => $reg_data['username'],
            'phone' => $reg_data['phone'],
            'password' => '32132332321123',
        ];
        PostJwtRegisterAction::execute($reg_data);
        PostJwtLoginAction::execute($login_data);
        PostJwtLogoutAction::execute();
        $this->assertEquals(1, User::get()->count());
        $this->assertTrue(! auth()->check());
    }
}
